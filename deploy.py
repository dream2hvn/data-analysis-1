# -*- coding: utf-8 -*-
"""deploy.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1duUpFilMdbui4_R1IZG8_t5LF6ff62no
"""
"""# **Pack**"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import folium
from folium.plugins import MarkerCluster

# Judul Dashboard
st.title("Dashboard Analisis E-commerce")

# Fungsi untuk memuat dataset
@st.cache
def load_data():
    return customers, geolocation, orders, order_items, order_payments

# Memuat data
customers, geolocation, orders, order_items, order_payments = load_data()

# Menampilkan data dasar
st.header("Informasi Dataset")
st.subheader("Customers Dataset")
st.write(customers.info())
st.write(customers.head())

st.subheader("Geolocation Dataset")
st.write(geolocation.info())
st.write(geolocation.head())

st.subheader("Orders Dataset")
st.write(orders.info())
st.write(orders.head())

# Memeriksa missing values
st.header("Missing Values di Setiap Dataset")
st.write("Missing values in Customers dataset:", customers.isnull().sum())
st.write("Missing values in Geolocation dataset:", geolocation.isnull().sum())
st.write("Missing values in Orders dataset:", orders.isnull().sum())

# Membuat visualisasi data penjualan
st.header("Visualisasi Data Penjualan")
total_sales = order_items.groupby('order_id').price.sum()
st.write(f"Total penjualan: {total_sales.sum()}")

# Visualisasi Missing Values
st.subheader("Visualisasi Missing Values")
missing_values = customers.isnull().sum().reset_index()
missing_values.columns = ['Column', 'Missing Values']

fig, ax = plt.subplots()
ax.bar(missing_values['Column'], missing_values['Missing Values'])
ax.set_ylabel('Jumlah Missing Values')
ax.set_title('Missing Values per Kolom di Dataset Customers')
plt.xticks(rotation=45)
st.pyplot(fig)

# Peta Geolokasi Pelanggan
st.header("Peta Geolokasi Pelanggan")

# Mengambil hanya kolom latitude (geolocation_lat)
# Tambahkan nilai default untuk longitude, misalnya 0 atau nilai rata-rata dari longitude
geolocation_map = geolocation[['geolocation_lat']].copy()

# Tambahkan kolom longitude dengan nilai tetap, misalnya longitude 110 (longitude Indonesia tengah)
geolocation_map['geolocation_lng'] = 110.0  # Nilai default untuk longitude, misalnya Indonesia

# Mengganti nama kolom agar sesuai dengan yang diharapkan oleh st.map()
geolocation_map.columns = ['lat', 'lon']

# Menampilkan peta dengan Streamlit
st.map(geolocation_map)

# Peta interaktif dengan Folium
st.subheader("Peta Interaktif Pelanggan")
m = folium.Map(location=[-15.77972, -47.92972], zoom_start=4)
marker_cluster = MarkerCluster().add_to(m)

for idx, row in geolocation.iterrows():
    folium.Marker(location=[row['geolocation_lat'], row['geolocation_lng']],
                  popup=row['geolocation_zip_code_prefix']).add_to(marker_cluster)
